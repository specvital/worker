---
title: ν΄λ¦° μ•„ν‚¤ν…μ² λ μ΄μ–΄
description: 6κ°μ λ…ν™•ν• λ μ΄μ–΄λ΅ κµ¬μ„±λ Clean Architecture κµ¬μ΅°
---

# ADR-02: ν΄λ¦° μ•„ν‚¤ν…μ² λ μ΄μ–΄ λ„μ…

> π‡Ίπ‡Έ [English Version](/en/adr/collector/02-clean-architecture-layers.md)

| λ‚ μ§       | μ‘μ„±μ       | λ¦¬ν¬μ§€ν† λ¦¬ |
| ---------- | ------------ | ---------- |
| 2024-12-18 | @KubrickCode | collector  |

## λ°°κ²½

### μ΄κΈ° μ•„ν‚¤ν…μ² λ¬Έμ μ 

μ΄κΈ° λ¨λ†€λ¦¬μ‹ κµ¬μ΅°λ” μ½”λ“λ² μ΄μ¤κ°€ μ„±μ¥ν•λ©΄μ„ μ—¬λ¬ λ¬Έμ λ¥Ό λ“λ¬λƒλ‹¤:

**λ„λ©”μΈ-μΈν”„λΌ κ²°ν•©:**

- λΉ„μ¦λ‹μ¤ λ΅μ§μ΄ λ°μ΄ν„°λ² μ΄μ¤ μΏΌλ¦¬ λ° ν μ‘μ—…κ³Ό λ’¤μ„μ„
- μΈν”„λΌ μ„Έλ¶€μ‚¬ν•­(μ: PostgreSQL μΏΌλ¦¬, River νƒμ¤ν¬ μ²λ¦¬) λ³€κ²½μ΄ ν•µμ‹¬ λΉ„μ¦λ‹μ¤ λ΅μ§ μμ • ν•„μ”

**μ ν•λ ν…μ¤νΈ μ©μ΄μ„±:**

- κµ¬μ²΄ κµ¬ν„μ— λ€ν• μ§μ ‘ μμ΅΄μΌλ΅ μΈν•΄ λ‹¨μ„ ν…μ¤νΈκ°€ μ–΄λ ¤μ›€
- λ€κ·λ¨ λ¦¬ν©ν† λ§ μ—†μ΄λ” Mock μ£Όμ… λ¶κ°€λ¥
- λ‹¨μν• λΉ„μ¦λ‹μ¤ κ·μΉ™ κ²€μ¦μ—λ„ ν†µν•© ν…μ¤νΈ ν•„μ”

**λ³€κ²½ μν–¥:**

- μ™Έλ¶€ λΌμ΄λΈλ¬λ¦¬ μ „ν™(μ: λ‹¤λ¥Έ ν μ‹μ¤ν…)μ΄ λΉ„μ¦λ‹μ¤ λ΅μ§ μ¬μ‘μ„± ν•„μ”
- κ΄€μ‹¬μ‚¬ κ°„ λ…ν™•ν• κ²½κ³„ λ¶€μ¬λ΅ μ½”λ“ νƒμƒ‰ μ–΄λ ¤μ›€

### λ©ν‘

1. **κ΄€μ‹¬μ‚¬ λ¶„λ¦¬**: λΉ„μ¦λ‹μ¤ λ΅μ§μ„ μΈν”„λΌ μ„Έλ¶€μ‚¬ν•­μΌλ΅λ¶€ν„° κ²©λ¦¬
2. **ν…μ¤νΈ μ©μ΄μ„±**: Mock μμ΅΄μ„±μ„ ν†µν• λ‹¨μ„ ν…μ¤νΈ κ°€λ¥
3. **μ μ—°μ„±**: λΉ„μ¦λ‹μ¤ κ·μΉ™μ— μν–¥ μ—†μ΄ μΈν”„λΌ λ³€κ²½ ν—μ©
4. **ν™•μ¥μ„±**: κ³µμ λ λΉ„μ¦λ‹μ¤ λ΅μ§μΌλ΅ λ‹¤μ¤‘ μ§„μ…μ (Worker, Scheduler, CLI) μ§€μ›
5. **μ½”λ“ κ°€λ…μ„±**: λ…ν™•ν• λ μ΄μ–΄ κ²½κ³„λ¥Ό ν†µν• μ½”λ“ νƒμƒ‰ λ° λ¦¬λ·° ν¨μ¨μ„± ν–¥μƒ
6. **AI κΈ°λ° κ°λ°**: μ‘μ—… λ²”μ„λ¥Ό νΉμ • λ μ΄μ–΄λ΅ ν•μ •ν•μ—¬ μ»¨ν…μ¤νΈ ν¬κΈ°λ¥Ό μ ν•, AI κΈ°λ° μ½”λ”©μ ν¨κ³Όμ  ν™μ© κ°€λ¥

## κ²°μ •

**6κ°μ λ…ν™•ν• λ μ΄μ–΄λ΅ κµ¬μ„±λ Clean Architecture λ μ΄μ–΄ κµ¬μ΅° μ±„νƒ**

### λ μ΄μ–΄ κµ¬μ΅°

| λ μ΄μ–΄         | μ±…μ„                                         |
| -------------- | -------------------------------------------- |
| Domain         | λΉ„μ¦λ‹μ¤ λ΅μ§ λ° μΈν„°νμ΄μ¤ μ •μ             |
| UseCase        | λΉ„μ¦λ‹μ¤ μ›ν¬ν”λ΅μ° μ¤μΌ€μ¤νΈλ μ΄μ…           |
| Adapter        | μΈν„°νμ΄μ¤ κµ¬ν„μ²΄ (Repository, VCS, Parser)  |
| Handler        | μ§„μ…μ  μ–΄λ‘ν„° (ν ν•Έλ“¤λ¬, μ¤μΌ€μ¤„λ¬ μ‘μ—…)     |
| Infrastructure | κΈ°μ  μ»΄ν¬λ„νΈ (DB ν’€, ν ν΄λΌμ΄μ–ΈνΈ, Config) |
| Application    | μμ΅΄μ„± μ£Όμ… μ»¨ν…μ΄λ„                         |

### μμ΅΄μ„± κ·μΉ™

μμ΅΄μ„±μ€ λ‚΄λ¶€λ΅λ§ νλ¥Έλ‹¤:

```
Command (main) β†’ Application β†’ Handler β†’ UseCase β†’ Domain
                      β†“            β†“         β†“
                Infrastructure   Adapter   (μμ΅΄μ„± μ—†μ)
```

- **Domain Layer**λ” μ™Έλ¶€ μμ΅΄μ„±μ΄ μ—†μ
- **UseCase Layer**λ” Domain μΈν„°νμ΄μ¤μ—λ§ μμ΅΄
- **Adapter Layer**λ” Infrastructureλ¥Ό μ‚¬μ©ν•μ—¬ Domain μΈν„°νμ΄μ¤ κµ¬ν„
- **Handler Layer**λ” μ™Έλ¶€ μ”μ²­μ„ UseCase νΈμ¶λ΅ λ³€ν™
- **Application Layer**λ” μμ΅΄μ„±μ„ μ—°κ²°

### λ μ΄μ–΄ μ„Έλ¶€μ‚¬ν•­

**Domain Layer:**

- μΈν„°νμ΄μ¤ μ •μ: `Repository`, `VCS`, `Parser`, `TokenLookup`
- λΉ„μ¦λ‹μ¤ λ¨λΈ λ° Value Object ν¬ν•¨
- λ„λ©”μΈ νΉν™” μ—λ¬ μ •μ
- μ™Έλ¶€ ν¨ν‚¤μ§€ import μ—†μ

**UseCase Layer:**

- λΉ„μ¦λ‹μ¤ μ›ν¬ν”λ΅μ° μ¤μΌ€μ¤νΈλ μ΄μ… (μ: Clone β†’ Parse β†’ Save)
- Domain μΈν„°νμ΄μ¤μ—λ§ μμ΅΄ (μƒμ„± μ‹ μ£Όμ…)
- λ™μ‹μ„± μ ν•, νƒ€μ„μ•„μ›ƒ λ“± ν΅λ‹¨ κ΄€μ‹¬μ‚¬ κ΄€λ¦¬

**Adapter Layer:**

- νΉμ • κΈ°μ λ΅ Domain μΈν„°νμ΄μ¤ κµ¬ν„
- μ: PostgreSQL μ €μ¥μ†, Git VCS μ–΄λ‘ν„°, Core νμ„ μ–΄λ‘ν„°
- λ„λ©”μΈ λ¨λΈκ³Ό μ™Έλ¶€ λ°μ΄ν„° ν¬λ§· κ°„ λ§¤ν•‘

**Handler Layer:**

- μ™Έλ¶€ νΈλ¦¬κ±°(River νƒμ¤ν¬, Cron μ‘μ—…)μ μ§„μ…μ 
- μ”μ²­ νλΌλ―Έν„° μ¶”μ¶ λ° UseCase νΈμ¶
- ν”„λ μ„μ›ν¬ νΉν™” κ΄€μ‹¬μ‚¬ μ²λ¦¬ (νμ΄λ΅λ“ μ–Έλ§μ…λ§, μ—λ¬ μ½”λ“)

**Infrastructure Layer:**

- λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²° ν’€ κ΄€λ¦¬
- ν ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ μ„¤μ •
- μ„¤μ • λ΅λ”©
- λ¶„μ‚° λ½ κµ¬ν„

**Application Layer:**

- DI μ»¨ν…μ΄λ„ μ •μ
- μ§„μ…μ λ³„ μμ΅΄μ„± μ—°κ²°
- μƒλ…μ£ΌκΈ° κ΄€λ¦¬ (μ‹μ‘/μΆ…λ£)

## κ²€ν† ν• μµμ…

### μµμ… A: Clean Architecture (μ„ νƒ)

**μ„¤λ…:**

μ—„κ²©ν• μμ΅΄μ„± κ·μΉ™μ„ κ°€μ§„ 6-λ μ΄μ–΄ κµ¬μ΅°. μ™Έλ¶€ μμ΅΄μ„±μ΄ μ—†λ” Domainμ΄ μ¤‘μ‹¬.

**μ¥μ :**

- λ…ν™•ν• κ΄€μ‹¬μ‚¬ λ¶„λ¦¬
- μΈν„°νμ΄μ¤ μ£Όμ…μ„ ν†µν• λ†’μ€ ν…μ¤νΈ μ©μ΄μ„±
- κΈ°μ  λ³€κ²½μ΄ μ–΄λ‘ν„°/μΈν”„λΌ λ μ΄μ–΄μ— κ²©λ¦¬
- κ³µμ λ λΉ„μ¦λ‹μ¤ λ΅μ§μΌλ΅ λ‹¤μ¤‘ μ§„μ…μ  μ§€μ›

**λ‹¨μ :**

- μ΄κΈ° μ„¤μ • λ³µμ΅λ„
- κ΄€λ¦¬ν•  νμΌκ³Ό ν¨ν‚¤μ§€ μ¦κ°€
- ν¨ν„΄μ— μµμ™ν•μ§€ μ•μ€ ν€μ›μ ν•™μµ κ³΅μ„ 

### μµμ… B: λ¨λ†€λ¦¬μ‹ κµ¬μ΅° μ μ§€

**μ„¤λ…:**

μ§μ ‘ μμ΅΄μ„±μ„ κ°€μ§„ λ‹¨μΌ ν¨ν‚¤μ§€ κµ¬μ΅° μ μ§€.

**μ¥μ :**

- λ‹¨μν• μ΄κΈ° κµ¬μ΅°
- μ μ€ κ°„μ ‘ μ°Έμ΅°
- μ‘μ€ κΈ°λ¥ κµ¬ν„μ΄ λΉ λ¦„

**λ‹¨μ :**

- ν…μ¤νΈμ— ν†µν•© μ„¤μ • ν•„μ”
- λ³€κ²½μ΄ κ΄€μ‹¬μ‚¬ μ „λ°μ— νκΈ‰
- λ‹¤μ¤‘ μ§„μ…μ μΌλ΅ ν™•μ¥ μ–΄λ ¤μ›€

### μµμ… C: μ΅κ°ν• μ•„ν‚¤ν…μ²

**μ„¤λ…:**

λ κ·μ •μ μΈ λ‚΄λ¶€ κµ¬μ΅°λ¥Ό κ°€μ§„ ν¬νΈμ™€ μ–΄λ‘ν„° ν¨ν„΄.

**μ¥μ :**

- μ μ—°ν• λ‚΄λ¶€ μ΅°μ§
- ν¬νΈ(μΈν„°νμ΄μ¤)μ™€ μ–΄λ‘ν„°(κµ¬ν„μ²΄)μ— μ§‘μ¤‘
- μ λ¬Έμ„ν™”λ ν¨ν„΄

**λ‹¨μ :**

- λ‚΄λ¶€ λ μ΄μ–΄ κµ¬μ΅°μ— λ€ν• κ°€μ΄λ“ λ¶€μ΅±
- "μ• ν”λ¦¬μΌ€μ΄μ… μ΅κ°ν•" λ‚΄λ¶€κ°€ μ •μλμ§€ μ•μ
- Clean Architectureκ°€ μ΄ ν”„λ΅μ νΈ κ·λ¨μ— λ” μ‹¤ν–‰ κ°€λ¥ν• κµ¬μ΅° μ κ³µ

## κµ¬ν„ μ›μΉ™

### μΈν„°νμ΄μ¤ μ •μ μ„μΉ

μΈν„°νμ΄μ¤λ” κµ¬ν„μ²΄κ°€ μ•„λ‹ Domain λ μ΄μ–΄μ— μ •μ:

| μΈν„°νμ΄μ¤  | μ„μΉ             |
| ----------- | ---------------- |
| Repository  | `domain/` ν¨ν‚¤μ§€ |
| VCS         | `domain/` ν¨ν‚¤μ§€ |
| Parser      | `domain/` ν¨ν‚¤μ§€ |
| TokenLookup | `domain/` ν¨ν‚¤μ§€ |

μ΄λ¥Ό ν†µν•΄:

- Domain λ μ΄μ–΄λ” μΈν”„λΌ μμ΅΄μ„±μ΄ μ—†μ
- κµ¬ν„μ²΄ λ³€κ²½μ΄ λ„λ©”μΈ μμ • μ—†μ΄ κ°€λ¥
- λ¨λ“  μ–΄λ‘ν„°μ— λ€ν• λ…ν™•ν• κ³„μ•½

### DI μ»¨ν…μ΄λ„ μ „λµ

μ§„μ…μ λ³„ λ³„λ„ μ»¨ν…μ΄λ„:

| μ»¨ν…μ΄λ„           | λ©μ                | νΉλ³„ν• μμ΅΄μ„±           |
| ------------------ | ------------------ | ----------------------- |
| WorkerContainer    | ν νƒμ¤ν¬ μ²λ¦¬     | μ•”νΈν™” ν‚¤ (ν† ν° λ³µνΈν™”) |
| SchedulerContainer | Cron μ‘μ—… μ¤μΌ€μ¤„λ§ | λ¶„μ‚° λ½                 |

**κ·Όκ±°:**

- λ‹¤λ¥Έ μ§„μ…μ μ€ λ‹¤λ¥Έ μμ΅΄μ„± μ”κµ¬μ‚¬ν•­μ„ κ°€μ§
- Schedulerλ” μ•”νΈν™” λ¶ν•„μ” (private μ €μ¥μ† μ ‘κ·Ό μ• ν•¨)
- Workerλ” λ¶„μ‚° λ½ λ¶ν•„μ” (νκ°€ λ™μ‹μ„± μ²λ¦¬)

### λ™μ‹μ„± μ μ–΄ μ„μΉ

λΉ„μ¦λ‹μ¤ μμ¤€μ λ™μ‹μ„± κ²°μ •(μ: μµλ€ λ™μ‹ clone)μ€ Adapterκ°€ μ•„λ‹ UseCase λ μ΄μ–΄μ— μ†ν•¨:

- μ„Έλ§ν¬μ–΄ κΈ°λ° μ¤λ΅ν‹€λ§μ€ λ¦¬μ†μ¤ ν• λ‹Ήμ— κ΄€ν• **λΉ„μ¦λ‹μ¤ κ²°μ •**
- Adapter λ μ΄μ–΄λ” μ •μ±…μ΄ μ•„λ‹ **κΈ°μ μ  μ‹¤ν–‰**μ— μ§‘μ¤‘

## κ²°κ³Ό

### κΈμ •μ 

**ν…μ¤νΈ μ©μ΄μ„±:**

- Mock μ—†μ΄ λ„λ©”μΈ λ΅μ§ ν…μ¤νΈ κ°€λ¥
- κ°„λ‹¨ν• μΈν„°νμ΄μ¤ MockμΌλ΅ UseCase ν…μ¤νΈ κ°€λ¥
- λΉ„μ¦λ‹μ¤ κ·μΉ™ κ²€μ¦μ— λ°μ΄ν„°λ² μ΄μ¤/ν λ¶ν•„μ”

**μ μ§€λ³΄μμ„±:**

- λ…ν™•ν• κ²½κ³„λ΅ μΈμ§€ λ¶€ν• κ°μ†
- ν• λ μ΄μ–΄ λ³€κ²½μ΄ λ‹¤λ¥Έ λ μ΄μ–΄μ— κ±°μ μν–¥ μ—†μ
- μ μ •μλ μ±…μ„μΌλ΅ μ¨λ³΄λ”© μ©μ΄

**μ μ—°μ„±:**

- λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ…: μ–΄λ‘ν„° λ μ΄μ–΄λ§ λ³€κ²½
- ν μ‹μ¤ν… μ „ν™: μΈν”„λΌ/ν•Έλ“¤λ¬ λ μ΄μ–΄λ§ λ³€κ²½
- μƒ μ§„μ…μ  (μ: HTTP API): ν•Έλ“¤λ¬ μ¶”κ°€, UseCase μ¬μ‚¬μ©

**ν™•μ¥μ„±:**

- Workerμ™€ Scheduler λ…λ¦½μ  μ¤μΌ€μΌλ§
- κ³µμ λ UseCase λ΅μ§μΌλ΅ μΌκ΄€μ„± λ³΄μ¥
- μ»¨ν…μ΄λ„ λ¶„λ¦¬λ΅ λ°°ν¬ μ μ—°μ„±

### λ¶€μ •μ 

**μ΄κΈ° λ³µμ΅λ„:**

- λ¨λ†€λ¦¬μ‹ μ ‘κ·Όλ³΄λ‹¤ λ§μ€ ν¨ν‚¤μ§€μ™€ νμΌ
- μμ΅΄μ„± νλ¦„ μ΄ν•΄μ— λ¬Έμ„ν™” ν•„μ”

**κ°„μ ‘ μ°Έμ΅°:**

- μ§„μ…μ κ³Ό λΉ„μ¦λ‹μ¤ λ΅μ§ μ‚¬μ΄μ— λ” λ§μ€ λ μ΄μ–΄
- λ””λ²„κΉ…μ΄ μ—¬λ¬ ν¨ν‚¤μ§€ μ¶”μ  ν•„μ”ν•  μ μμ

**λ‹¨μ μ‘μ—…μ μ¤λ²„ν—¤λ“:**

- λ‹¨μν• CRUDλ„ μ „μ²΄ λ μ΄μ–΄ μν ν•„μ”
- μ§κ΄€μ μΈ κΈ°λ¥μ— κ³Όλ„ν•κ² λκ»΄μ§ μ μμ

## μ°Έκ³  μλ£

- [Clean Architecture by Robert C. Martin](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [ADR-01: μ½”μ–΄ λΌμ΄λΈλ¬λ¦¬ λ¶„λ¦¬](/ko/adr/core/01-core-library-separation.md) (Core)

---
title: NaCl SecretBox μ•”νΈν™”
description: OAuth ν† ν° μ•”νΈν™”λ¥Ό μ„ν• NaCl SecretBox μ„ νƒ κ²°μ •
---

# ADR-13: NaCl SecretBox μ•”νΈν™”

> π‡Ίπ‡Έ [English Version](/en/adr/core/13-nacl-secretbox-encryption.md)

| λ‚ μ§       | μ‘μ„±μ       | λ¦¬ν¬μ§€ν† λ¦¬           |
| ---------- | ------------ | -------------------- |
| 2025-12-23 | @KubrickCode | core, web, collector |

## λ°°κ²½

### λ¬Έμ  μƒν™©

λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥λλ” OAuth ν† ν°μ€ μ•”νΈν™”κ°€ ν•„μ”ν•¨. μ—¬λ¬ μ„λΉ„μ¤μ—μ„ ν† ν° μ•”λ³µνΈν™”κ°€ λ°μƒν•¨:

1. **Web μ„λΉ„μ¤**: OAuth μκ²©μ¦λ… μ €μ¥ μ‹ μ•”νΈν™”
2. **Collector μ„λΉ„μ¤**: GitHub API μ ‘κ·Ό μ‹ λ³µνΈν™”

### μ”κµ¬μ‚¬ν•­

| μ”κµ¬μ‚¬ν•­         | μ„¤λ…                                   |
| ---------------- | -------------------------------------- |
| μΈμ¦λ μ•”νΈν™”    | λ³€μ΅° λ°©μ§€ λ° λ°μ΄ν„° λ¬΄κ²°μ„± λ³΄μ¥        |
| λ€μΉ­ν‚¤           | λ™μΌ ν‚¤λ΅ μ•”λ³µνΈν™”                     |
| μ¤λ λ“ μ•μ „      | λ©€ν‹° κ³ λ£¨ν‹΄ ν™κ²½μ—μ„ λ™μ‹ μ•”νΈν™” κ°€λ¥  |
| μ„λΉ„μ¤ κ°„ κ³µμ    | web/collectorμ—μ„ λ™μΌ μ½”λ“λ² μ΄μ¤ μ‚¬μ© |
| ν‚¤ λ΅ν…μ΄μ… μ§€μ› | λ°μ΄ν„° μ†μ‹¤ μ—†μ΄ ν‚¤ κµμ²΄ κ°€λ¥          |

## κ²°μ •

**NaCl SecretBox (XSalsa20 + Poly1305)λ¥Ό λ€μΉ­ μΈμ¦ μ•”νΈν™”μ— μ‚¬μ©ν•¨.**

`pkg/crypto` ν¨ν‚¤μ§€ μ κ³µ μ‚¬ν•­:

- μ•”λ³µνΈν™”λ¥Ό μ„ν• `Encryptor` μΈν„°νμ΄μ¤
- Base64 μΈμ½”λ”© μ¶λ ¥ ν•μ‹: `Base64(nonce || ciphertext)`
- νƒ€μ… μ•μ „ν• μ—λ¬ μ²λ¦¬λ¥Ό μ„ν• μ„Όν‹°λ„ μ—λ¬
- μ¤λ λ“ μ•μ „ κµ¬ν„

## κ²€ν† ν• μµμ…

### Option A: NaCl SecretBox (μ„ νƒλ¨)

XSalsa20 μ¤νΈλ¦Ό μ•”νΈ + Poly1305 MAC.

**μ¥μ :**

- **μ¤μ© λ°©μ§€ μ„¤κ³„**: 192λΉ„νΈ nonceλ΅ μ¶©λ μ„ν— μ‚¬μ‹¤μƒ μ κ±°
- **μΈμ¦λ¨**: Poly1305 MACμΌλ΅ λ³€μ΅° κ°μ§€
- **λ‹¨μν• API**: λ‹¨μΌ ν•¨μ, μ¤μ©ν•κΈ° μ–΄λ ¤μ›€
- **κ²€μ¦λ¨**: libsodium κµ¬ν„, κ΄‘λ²”μ„ν• λ³΄μ• κ°μ‚¬ μ™„λ£
- **IV κ΄€λ¦¬ λ¶ν•„μ”**: μ•”νΈν™”λ§λ‹¤ λλ¤ nonce μλ™ μƒμ„±

**λ‹¨μ :**

- FIPS-140 λΉ„μ¤€μ (κ·μ • μ¤€μ ν•„μ” μ‹)
- μ—”ν„°ν”„λΌμ΄μ¦ ν™κ²½μ—μ„ AESλ³΄λ‹¤ λ μΌλ°μ 

### Option B: AES-GCM

Galois/Counter Mode AES.

**μ¥μ :**

- FIPS-140 μ¤€μ
- ν•λ“μ›¨μ–΄ κ°€μ† (AES-NI)
- μ—…κ³„ ν‘μ¤€

**λ‹¨μ :**

- **96λΉ„νΈ nonce**: μ¶©λ μ„ν— λ†’μ, nonce μ¶”μ  ν•„μ”
- **nonce μ¬μ‚¬μ© μΉλ…μ **: μ¬μ‚¬μ© μ‹ μΈμ¦ ν‚¤ λ…Έμ¶
- λ³µμ΅ν• API, μ¤μ© κ°€λ¥μ„±

### Option C: AES-CBC + HMAC

μ•”νΈν™”μ© AES-CBC, μΈμ¦μ© λ³„λ„ HMAC.

**μ¥μ :**

- FIPS-140 μ¤€μ
- μ μ•λ ¤μ§„ λ°©μ‹

**λ‹¨μ :**

- **Encrypt-then-MAC μμ„ μ¤‘μ”**: μλ»λ μμ„λ” λ³΄μ• μ·¨μ•½
- **IV κ΄€λ¦¬ ν•„μ”**: μ μΌμ„± λ³΄μ¥ ν•„μ
- **ν¨λ”© μ¤λΌν΄ κ³µκ²©**: μ‹ μ¤‘ν• κµ¬ν„ ν•„μ”
- μ½”λ“λ‰ μ¦κ°€, μ¤λ¥ κ°€λ¥μ„± μ¦κ°€

## κ²°κ³Ό

### κΈμ •μ 

1. **λ‹¨μμ„±**
   - λ‹¨μΌ `Seal`/`Open` ν•¨μ μ
   - λλ¤ nonce μλ™ μƒμ„±
   - λ¨λ“ μ„ νƒμ΄λ‚ νλΌλ―Έν„° μ΅°μ • λ¶ν•„μ”

2. **λ³΄μ• λ§μ§„**
   - 256λΉ„νΈ ν‚¤, 192λΉ„νΈ nonce
   - XSalsa20μ€ μ›λ³Έ Salsa20 λ€λΉ„ nonce κ³µκ°„ ν™•μ¥
   - μ•λ ¤μ§„ μ‹¤μ©μ  κ³µκ²© μ—†μ

3. **μ΄μ‹μ„±**
   - `golang.org/x/crypto`μ μμ Go κµ¬ν„
   - CGO μμ΅΄μ„± μ—†μ
   - ν¬λ΅μ¤ ν”λ«νΌ λΉλ“ κ°€λ¥

### λ¶€μ •μ 

1. **κ·μ • μ¤€μ μ ν•**
   - FIPS-140 μΈμ¦λμ§€ μ•μ
   - **μ™„ν™”**: ν„μ¬ μ‚¬μ© μ‚¬λ΅€(OAuth ν† ν°)μ—λ” ν—μ© κ°€λ¥

2. **μ•κ³ λ¦¬μ¦ μΆ…μ†**
   - μ•κ³ λ¦¬μ¦ λ³€κ²½ μ‹ μ „μ²΄ λ°μ΄ν„° μ¬μ•”νΈν™” ν•„μ”
   - **μ™„ν™”**: μΈν„°νμ΄μ¤ μ¶”μƒν™”λ΅ κµ¬ν„ κµμ²΄ κ°€λ¥

### κµ¬ν„ μ„Έλ¶€μ‚¬ν•­

**μ¶λ ¥ ν•μ‹:**

```
Base64(nonce || ciphertext)
       24 bytes   plaintext + 16 bytes overhead
```

**ν‚¤ κ΄€λ¦¬:**

```bash
# 32λ°”μ΄νΈ ν‚¤ μƒμ„±
openssl rand -base64 32
```

**μΈν„°νμ΄μ¤ μ„¤κ³„:**

```go
type Encryptor interface {
    Encrypt(plaintext string) (string, error)
    Decrypt(ciphertext string) (string, error)
    Close() error  // λ©”λ¨λ¦¬μ—μ„ ν‚¤ μ κ±°
}
```

## μ°Έκ³  μλ£

- [NaCl: Networking and Cryptography library](https://nacl.cr.yp.to/)
- [golang.org/x/crypto/nacl/secretbox](https://pkg.go.dev/golang.org/x/crypto/nacl/secretbox)
- [pkg/crypto/doc.go](https://github.com/specvital/core/blob/main/pkg/crypto/doc.go) - μ‚¬μ© μμ  ν¬ν•¨ ν¨ν‚¤μ§€ λ¬Έμ„

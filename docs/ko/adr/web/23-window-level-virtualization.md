---
title: ìœˆë„ìš° ë ˆë²¨ ê°€ìƒí™” íŒ¨í„´
description: ëŒ€ìš©ëŸ‰ ë¬¸ì„œ ë Œë”ë§ ì„±ëŠ¥ì„ ìœ„í•œ ìœˆë„ìš° ë ˆë²¨ ê°€ìƒí™” íŒ¨í„´ ADR
---

# ADR-23: ìœˆë„ìš° ë ˆë²¨ ê°€ìƒí™” íŒ¨í„´

> ğŸ‡ºğŸ‡¸ [English Version](/en/adr/web/23-window-level-virtualization.md)

| ë‚ ì§œ       | ì‘ì„±ì     | ë ˆí¬ |
| ---------- | ---------- | ---- |
| 2026-01-19 | @specvital | web  |

## ì»¨í…ìŠ¤íŠ¸

spec-view ëª¨ë“œì—ì„œ 1000ê°œ ì´ìƒì˜ behavior ë¡œë”© ì‹œ ì‹¬ê°í•œ ì„±ëŠ¥ ì €í•˜ ë°œìƒ:

| ì´ìŠˆ                 | ì„¤ëª…                                                                                    |
| -------------------- | --------------------------------------------------------------------------------------- |
| ê³„ì‚° ë³‘ëª©            | `computeFilteredDocument()`ê°€ O(n^3) ë³µì¡ë„ë¡œ ë§¤ ë Œë” ì‚¬ì´í´ë§ˆë‹¤ ì¬ê³„ì‚°                 |
| ë¶ˆì¶©ë¶„í•œ ê°€ìƒí™” ë²”ìœ„ | 100+ ì„ê³„ê°’ì—ì„œ behavior ë ˆë²¨ë§Œ ê°€ìƒí™”; Domain/Feature ë ˆë²¨ ê°€ìƒí™” ë¶€ì¬                 |
| ì¤‘ì²© êµ¬ì¡° ë¬¸ì œ       | ê¹Šì€ 4ë‹¨ê³„ ê³„ì¸µ (Document -> Domain -> Feature -> Behavior)ì´ ì „í†µì  ê°€ìƒí™” ì ‘ê·¼ ë³µì¡í™” |

### ì´ì „ ì ‘ê·¼ë²• ë¬¸ì œ

`useVirtualizer`ë¥¼ ì‚¬ìš©í•œ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ê°€ìƒí™”ì˜ ì¹˜ëª…ì  UX ì´ìŠˆ:

- **ë¶ˆì¼ì¹˜í•˜ëŠ” ìŠ¤í¬ë¡¤ ê²½í—˜**: ê° ê°€ìƒí™” ì„¹ì…˜ë³„ ë³„ë„ ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆê°€ í†µí•© í˜ì´ì§€ ìŠ¤í¬ë¡¤ íŒ¨í„´ íŒŒê´´
- **CSS ë ˆì´ì•„ì›ƒ ë¶•ê´´**: ì»¨í…Œì´ë„ˆ ê°€ìƒí™”ì— í•„ìš”í•œ `position: absolute` ë ˆì´ì•„ì›ƒì´ ì¼ë°˜ CSS ê°„ê²©, ì¹´ë“œ êµ¬ì¡°, ì‹œê°ì  ê·¸ë£¹í•‘ í›¼ì†

### ì œì•½ ì¡°ê±´

| ì œì•½           | ì„¤ëª…                                                          |
| -------------- | ------------------------------------------------------------- |
| React Compiler | ìë™ ë©”ëª¨ì´ì œì´ì…˜ì„ ê¹¨ëŠ” íŒ¨í„´ ì—†ì´ React Compilerì™€ í˜¸í™˜ í•„ìˆ˜ |
| UX ì¼ê´€ì„±      | ë‹¨ì¼ í˜ì´ì§€ ìŠ¤í¬ë¡¤; ì¤‘ì²© ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ ê¸ˆì§€                 |
| ì‹œê°ì  ê·¸ë£¹í•‘  | Domain/Feature ì¹´ë“œ êµ¬ì¡° ìœ ì§€ í•„ìˆ˜                            |
| ì„ê³„ê°’ ë¯¼ê°ë„  | ì†Œê·œëª¨ (< 30ê°œ)ì™€ ëŒ€ê·œëª¨ (1000+) ë°ì´í„°ì…‹ ëª¨ë‘ ì²˜ë¦¬           |

## ê²°ì •

**TanStack Virtualì˜ `useWindowVirtualizer`ë¥¼ ì‚¬ìš©í•œ ìœˆë„ìš° ë ˆë²¨ ê°€ìƒí™”ì™€ í”Œë« ë°°ì—´ ë³€í™˜ ë° ì§€ì—° ë Œë”ë§ ì±„íƒ.**

### í•µì‹¬ êµ¬í˜„

1. **í”Œë« ë°°ì—´ ë³€í™˜**: `flattenSpecDocument()`ê°€ ì¤‘ì²© ê³„ì¸µì„ íƒ€ì… êµ¬ë¶„ìê°€ ìˆëŠ” ë‹¨ì¼ ë°°ì—´ë¡œ ë³€í™˜
2. **ìœˆë„ìš° ë ˆë²¨ ê°€ìƒí™”**: `useWindowVirtualizer`ê°€ ë¸Œë¼ìš°ì € ìœˆë„ìš°ë¥¼ ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆë¡œ ì‚¬ìš©í•˜ì—¬ ì¤‘ì²© ìŠ¤í¬ë¡¤ ì´ìŠˆ ì œê±°
3. **ì§€ì—° ë Œë”ë§**: React 18ì˜ `useDeferredValue`ê°€ í•„í„°/ê²€ìƒ‰ ì‘ì—… ì¤‘ UI ë¸”ë¡œí‚¹ ë°©ì§€
4. **ë‚®ì¶˜ ì„ê³„ê°’**: 100ì—ì„œ 30ìœ¼ë¡œ ê°ì†Œí•˜ì—¬ ì¡°ê¸° ìµœì í™” í™œì„±í™”
5. **CSS ê¸°ë°˜ ê·¸ë£¹í•‘**: `isLastInDomain` í”Œë˜ê·¸ê°€ ë ˆì´ì•„ì›ƒ íŒŒê´´ ì—†ì´ ì‹œê°ì  ë¶„ë¦¬ ê°€ëŠ¥í•˜ê²Œ í•¨

### ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ

**@tanstack/react-virtual 3.13.6**

ëŒ€ì•ˆ ëŒ€ë¹„ ì„ íƒ ì´ìœ :

- í˜ì´ì§€ ë ˆë²¨ ìŠ¤í¬ë¡¤ì„ ìœ„í•œ ë„¤ì´í‹°ë¸Œ `useWindowVirtualizer` í›…
- ì´ë¯¸ ì˜ì¡´ì„± íŠ¸ë¦¬ì— í¬í•¨ (ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš© ì¤‘)
- React 19 í˜¸í™˜ (`useSyncExternalStore` ì‚¬ìš©)
- ì•Œë ¤ì§„ React Compiler í˜¸í™˜ì„± ì´ìŠˆë¥¼ `"use no memo"`ë¡œ ë¬¸ì„œí™” ë° ì™„í™” ([ADR-22](/ko/adr/web/22-react-compiler-adoption.md))

## ê³ ë ¤í•œ ì˜µì…˜

### ì˜µì…˜ A: í”Œë« ë°°ì—´ì„ ì‚¬ìš©í•œ ìœˆë„ìš° ë ˆë²¨ ê°€ìƒí™” (ì±„íƒ)

`flattenSpecDocument()`ê°€ `Document -> Domain[] -> Feature[] -> Behavior[]`ë¥¼ `FlatItem[]`ìœ¼ë¡œ ë³€í™˜. ê° `FlatItem`ì€ íƒ€ì… êµ¬ë¶„ì (`domain-header`, `feature-header`, `behavior-row`) í¬í•¨. `useWindowVirtualizer`ê°€ ìœˆë„ìš° ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¥¼ ì‚¬ìš©í•˜ì—¬ í”Œë« ë°°ì—´ ê°€ìƒí™”.

```typescript
type FlatSpecItem = FlatSpecDomainItem | FlatSpecFeatureItem | FlatSpecBehaviorItem;

const flatItems = useMemo(() => flattenSpecDocument(document), [document]);
const virtualizer = useWindowVirtualizer({
  count: flatItems.length,
  estimateSize: (index) => getItemHeight(flatItems[index].type),
  overscan: 5,
});
const deferredItems = useDeferredValue(virtualizer.getVirtualItems());
```

| ì¥ì                                     | ë‹¨ì                              |
| --------------------------------------- | -------------------------------- |
| ë‹¨ì¼ ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ (ìœˆë„ìš°)           | í”Œë« ë°°ì—´ ë³€í™˜ì´ ë³µì¡ë„ ì¶”ê°€     |
| ì¼ë°˜ CSS ë ˆì´ì•„ì›ƒ ìœ ì§€                  | ë Œë” í•¨ìˆ˜ì—ì„œ íƒ€ì… ì²´í‚¹ ì˜¤ë²„í—¤ë“œ |
| React Compiler í˜¸í™˜ (escape hatch ì‚¬ìš©) | `estimateSize` ìº˜ë¦¬ë¸Œë ˆì´ì…˜ í•„ìš” |
| `useDeferredValue`ê°€ UI ì‘ë‹µì„± ìœ ì§€     | í”Œë« ë°°ì—´ì˜ ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œ      |

### ì˜µì…˜ B: ì»¨í…Œì´ë„ˆ ë ˆë²¨ ê°€ìƒí™”

Domain/Feature ì„¹ì…˜ë³„ ë³µìˆ˜ì˜ `useVirtualizer` ì¸ìŠ¤í„´ìŠ¤. ê° ì„¹ì…˜ì´ ìì²´ ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ ë³´ìœ .

| ì¥ì                   | ë‹¨ì                                  |
| --------------------- | ------------------------------------ |
| ì„¹ì…˜ë³„ ë¡œì§ì´ ë” ë‹¨ìˆœ | ë³µìˆ˜ ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ (UX ë¶„ì—´)       |
| í”Œë« ë°°ì—´ ë³€í™˜ ë¶ˆí•„ìš” | `position: absolute`ê°€ CSS ê°„ê²© íŒŒê´´ |
|                       | ì¹´ë“œ êµ¬ì¡° ë¶•ê´´                       |

**ê¸°ê°**: UX í‡´í–‰ì´ êµ¬í˜„ ë‹¨ìˆœì„±ì„ ìƒíšŒ. ì»¤ë°‹ `2c45796`ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ì´ íŒ¨í„´ì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜.

### ì˜µì…˜ C: ê°€ìƒí™” ì—†ì´ í˜ì´ì§€ë„¤ì´ì…˜

Domain/Featureë¥¼ í˜ì´ì§€ë„¤ì´ì…˜ (ì˜ˆ: í˜ì´ì§€ë‹¹ 10ê°œ ë„ë©”ì¸). í˜„ì¬ í˜ì´ì§€ ë‚´ ëª¨ë“  í•­ëª©ì„ ê°€ìƒí™” ì—†ì´ ë Œë”ë§.

| ì¥ì                     | ë‹¨ì                     |
| ----------------------- | ----------------------- |
| ê°€ì¥ ë‹¨ìˆœí•œ êµ¬í˜„        | ì—°ì†ì  íƒìƒ‰ UX íŒŒê´´     |
| ê°€ìƒí™” ì˜¤ë²„í—¤ë“œ ì—†ìŒ    | í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ë§ˆì°°  |
| ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ ì‚¬ìš© | O(n^3) ê³„ì‚° ì´ìŠˆ ë¯¸í•´ê²° |

**ê¸°ê°**: ìŠ¤í™ ë¬¸ì„œëŠ” ì—°ì†ì  ê³„ì¸µìœ¼ë¡œ íƒìƒ‰ë¨; í˜ì´ì§€ë„¤ì´ì…˜ì´ ì‚¬ìš©ì ê²½í—˜ ë¶„ì ˆ.

### ì˜µì…˜ D: ìŠ¤íŠ¸ë¦¬ë°ì„ ì‚¬ìš©í•œ ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§

ì„œë²„ê°€ ì´ˆê¸°ì— ë³´ì´ëŠ” ë¶€ë¶„ë§Œ ë Œë”ë§. ì‚¬ìš©ì ìŠ¤í¬ë¡¤ ì‹œ ì¶”ê°€ ì½˜í…ì¸  ìŠ¤íŠ¸ë¦¬ë° (React Server Components + Suspense).

| ì¥ì                  | ë‹¨ì                                |
| -------------------- | ---------------------------------- |
| í´ë¼ì´ì–¸íŠ¸ ê³„ì‚° ì œê±° | ì„œë²„ ì¸¡ ìŠ¤í¬ë¡¤ ìƒíƒœ í•„ìš”           |
| ë” ë¹ ë¥¸ ì´ˆê¸° í˜ì¸íŠ¸  | ìŠ¤í¬ë¡¤ ì‹œ ë„¤íŠ¸ì›Œí¬ ì§€ì—°            |
|                      | ë³µì¡í•œ SSR/í´ë¼ì´ì–¸íŠ¸ í•˜ì´ë“œë ˆì´ì…˜ |

**ê¸°ê°**: ë¬¸ì œ ëŒ€ë¹„ ê³¼ë„í•œ ì•„í‚¤í…ì²˜; í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê°€ìƒí™”ë¡œ ì¶©ë¶„.

## ê²°ê³¼

### ê¸ì •ì 

| ì˜ì—­            | ì´ì                                                        |
| --------------- | ---------------------------------------------------------- |
| ì„±ëŠ¥            | 1000+ behaviorê°€ ë¶€ë“œëŸ½ê²Œ ë Œë”ë§; ë³´ì´ëŠ” í•­ëª©ë§Œ DOMì— ì¡´ì¬ |
| UX ì¼ê´€ì„±       | ë‹¨ì¼ í˜ì´ì§€ ìŠ¤í¬ë¡¤; í†µí•©ëœ ìŠ¤í¬ë¡¤ ìœ„ì¹˜                     |
| CSS ë¬´ê²°ì„±      | ì¼ë°˜ í”Œë¡œìš° ë ˆì´ì•„ì›ƒ; ì¹´ë“œ êµ¬ì¡° ìœ ì§€                       |
| ì‘ë‹µì„±          | `useDeferredValue`ê°€ í•„í„°ë§ ì¤‘ ì…ë ¥ ì§€ì—° ë°©ì§€              |
| ì„ê³„ê°’ ì»¤ë²„ë¦¬ì§€ | 30ê°œ í•­ëª© ì„ê³„ê°’ì´ ë” ë§ì€ ì‹¤ì œ ì¼€ì´ìŠ¤ í¬ì°©                |

### ë¶€ì •ì 

| ì˜ì—­           | íŠ¸ë ˆì´ë“œì˜¤í”„                      | ì™„í™”                                                         |
| -------------- | --------------------------------- | ------------------------------------------------------------ |
| ë³µì¡ë„         | í”Œë« ë°°ì—´ ë³€í™˜ ë¡œì§               | `flattenSpecDocument()` ìœ í‹¸ë¦¬í‹°ì— ê²©ë¦¬                      |
| React Compiler | `"use no memo"` ì§€ì‹œì–´ í•„ìš”       | [ADR-22](/ko/adr/web/22-react-compiler-adoption.md)ì— ë¬¸ì„œí™” |
| íƒ€ì… ì•ˆì „ì„±    | ë Œë”ì—ì„œ ëŸ°íƒ€ì„ íƒ€ì… êµ¬ë¶„         | TypeScript ì¶•ì†Œë¥¼ ì‚¬ìš©í•œ ì™„ì „ switch                         |
| ì¶”ì • ì •í™•ë„    | `estimateSize` ë¶ˆì¼ì¹˜ë¡œ ì§€í„° ë°œìƒ | ì‹¤ì œ ë†’ì´ ì¸¡ì •; íŒ¨ë”© ë²„í¼ ì¶”ê°€                               |

### ê¸°ìˆ ì  í•¨ì˜

- **ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼**: í”Œë« ë°°ì—´ì´ êµ¬ì¡°ì  ë©”íƒ€ë°ì´í„°ë¥¼ ë³µì œí•˜ì§€ë§Œ DOM ë…¸ë“œë¥¼ nì—ì„œ ~20ê°œ (ë·°í¬íŠ¸ í¬ê¸°)ë¡œ ê°ì†Œ
- **ìŠ¤í¬ë¡¤ ë³µì›**: ìœˆë„ìš° ìŠ¤í¬ë¡¤ ìœ„ì¹˜ê°€ ë„¤ë¹„ê²Œì´ì…˜ ê°„ ìë™ ìœ ì§€ (ë¸Œë¼ìš°ì € ë„¤ì´í‹°ë¸Œ ë™ì‘)
- **ê²€ìƒ‰/í•„í„° í†µí•©**: í•„í„° ì‘ì—…ì´ í”Œë« ë°°ì—´ ì—…ë°ì´íŠ¸; `useDeferredValue`ê°€ ì¬ê°€ìƒí™” ì§€ì—°

## êµ¬í˜„ ìƒì„¸

### ì˜í–¥ë°›ëŠ” íŒŒì¼

| íŒŒì¼                            | ëª©ì                                                           |
| ------------------------------- | ------------------------------------------------------------- |
| `virtualized-document-view.tsx` | ë©”ì¸ ìœˆë„ìš° ë ˆë²¨ ê°€ìƒí™” ë·°                                    |
| `virtualized-behavior-list.tsx` | ì»¨í…Œì´ë„ˆ ë ˆë²¨ ê°€ìƒí™” behavior ë¦¬ìŠ¤íŠ¸ (ì´ì „ ì ‘ê·¼ë²•, ì„ê³„ê°’ 30) |
| `flatten-spec-document.ts`      | ê³„ì¸µì—ì„œ í”Œë« ë°°ì—´ë¡œ ë³€í™˜                                     |
| `flat-spec-item.ts`             | í”Œë« í•­ëª©ì„ ìœ„í•œ discriminated union íƒ€ì…                     |
| `use-document-filter.ts`        | `useDeferredValue`ë¥¼ ì‚¬ìš©í•œ ë¬¸ì„œ í•„í„°ë§                       |

### ë†’ì´ ì¶”ì • íŒ¨í„´

```typescript
const getItemHeight = (item: FlatSpecItem): number => {
  const baseHeight = item.type === "domain-header" ? 80 : item.type === "feature-header" ? 56 : 72;
  return baseHeight + (item.isLastInDomain ? DOMAIN_GAP : 0);
};
```

### ScrollMargin ì²˜ë¦¬

```typescript
const [scrollMargin, setScrollMargin] = useState(0);
useLayoutEffect(() => {
  setScrollMargin(listRef.current?.offsetTop ?? 0);
}, []);
```

## ì°¸ì¡°

- [71fce34](https://github.com/specvital/web/commit/71fce34): ë©”ì¸ ìœˆë„ìš° ê°€ìƒí™” êµ¬í˜„
- [a155369](https://github.com/specvital/web/commit/a155369): ì¹´ë“œ ê°„ ëˆ„ë½ëœ ê°„ê²© ìˆ˜ì •
- [9c41475](https://github.com/specvital/web/commit/9c41475): ë„ë©”ì¸ ì¹´ë“œ êµ¬ì¡° ë³µì›
- [2c45796](https://github.com/specvital/web/commit/2c45796): ì»¨í…Œì´ë„ˆì—ì„œ ìœˆë„ìš° ìŠ¤í¬ë¡¤ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
- [ADR-22: React Compiler ë„ì…](/ko/adr/web/22-react-compiler-adoption.md) - `"use no memo"` escape hatch íŒ¨í„´
- [ADR-04: TanStack Query ì„ íƒ](/ko/adr/web/04-tanstack-query-selection.md) - TanStack ì—ì½”ì‹œìŠ¤í…œ
- [TanStack Virtual ë¬¸ì„œ](https://tanstack.com/virtual/latest/docs/api/virtualizer)
- [React useDeferredValue](https://react.dev/reference/react/useDeferredValue)

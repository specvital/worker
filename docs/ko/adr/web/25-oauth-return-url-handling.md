---
title: OAuth ë¦¬í„´ URL ì²˜ë¦¬
description: OAuth ì¸ì¦ í”Œë¡œìš°ì—ì„œ ì¿ í‚¤ ê¸°ë°˜ ë¦¬í„´ URL ë³´ì¡´ì— ê´€í•œ ADR
---

# ADR-25: OAuth ë¦¬í„´ URL ì²˜ë¦¬

> ğŸ‡ºğŸ‡¸ [English Version](/en/adr/web/25-oauth-return-url-handling.md)

| ë‚ ì§œ       | ì‘ì„±ì     | ë¦¬í¬ì§€í† ë¦¬ |
| ---------- | ---------- | ---------- |
| 2026-01-16 | @specvital | web        |

## ì»¨í…ìŠ¤íŠ¸

í™ˆí˜ì´ì§€ ì™¸ì˜ í˜ì´ì§€ì—ì„œ GitHub OAuth ë¡œê·¸ì¸ ì‹œ ì›ë˜ í˜ì´ì§€ê°€ ì•„ë‹Œ ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë˜ëŠ” ë¬¸ì œ ë°œìƒ.

| ì§„ì… í˜ì´ì§€          | ê¸°ëŒ€ ë™ì‘              | ì‹¤ì œ ë™ì‘                    |
| -------------------- | ---------------------- | ---------------------------- |
| `/ko/pricing`        | `/ko/pricing`ìœ¼ë¡œ ë³µê·€ | `/ko/dashboard`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| `/ko/explore`        | `/ko/explore`ë¡œ ë³µê·€   | `/ko/dashboard`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| `/ko/{owner}/{repo}` | ë¶„ì„ í˜ì´ì§€ë¡œ ë³µê·€     | `/ko/dashboard`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |

### ê·¼ë³¸ ì›ì¸

**1. ë¦¬ë‹¤ì´ë ‰íŠ¸ ë¡œì§ ì¶©ëŒ**

í™ˆí˜ì´ì§€ì˜ `AuthenticatedRedirect` ì»´í¬ë„ŒíŠ¸ê°€ ì „ì—­ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë™ì‘ì— ì˜í–¥.

**2. í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ìŠ¤í† ë¦¬ì§€ ë¶ˆì¼ì¹˜**

```
Client (ë¸Œë¼ìš°ì €)                   Server (Route Handler)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ sessionStorage  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€Xâ”€â”€â”€â”€ â”‚ OAuth callback       â”‚
â”‚ (returnTo URL)  â”‚  ì ‘ê·¼ ë¶ˆê°€    â”‚ (code exchange)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ì´ˆê¸° êµ¬í˜„ì€ `sessionStorage`ì— `returnTo` ì €ì¥, í•˜ì§€ë§Œ Next.js App Router OAuth ì½œë°±ì€ ì„œë²„ ì‚¬ì´ë“œ Route Handlerë¡œ ì‹¤í–‰ë˜ì–´ ë¸Œë¼ìš°ì € `sessionStorage` ì ‘ê·¼ ë¶ˆê°€.

### ì œì•½ ì¡°ê±´

| ì œì•½ ì¡°ê±´              | ì¶œì²˜                                                | ì˜í–¥                               |
| ---------------------- | --------------------------------------------------- | ---------------------------------- |
| ì„œë²„ ì‚¬ì´ë“œ OAuth ì½œë°± | Next.js App Router                                  | í´ë¼ì´ì–¸íŠ¸ ì „ìš© ìŠ¤í† ë¦¬ì§€ ì‚¬ìš© ë¶ˆê°€ |
| ë¡œì¼€ì¼ ë³´ì¡´            | [ADR-17](/ko/adr/web/17-next-intl-i18n-strategy.md) | ë¦¬í„´ URLì— ë¡œì¼€ì¼ ì ‘ë‘ì‚¬ í¬í•¨ í•„ìˆ˜ |
| ë³´ì•ˆ ìš”êµ¬ì‚¬í•­          | OAuth ëª¨ë²” ì‚¬ë¡€                                     | ì˜¤í”ˆ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê³µê²© ë°©ì§€ í•„ìˆ˜     |

## ê²°ì •

**ì¿ í‚¤ ê¸°ë°˜ ë¦¬í„´ URL ì €ì¥ ë° ì„œë²„ ì‚¬ì´ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²€ì¦ ì±„íƒ.**

```typescript
// OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ ì „ (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ)
const returnTo = window.location.pathname;
document.cookie = `returnTo=${encodeURIComponent(returnTo)}; path=/; max-age=300; SameSite=Lax`;
```

```typescript
// OAuth ì½œë°± (ì„œë²„ ì‚¬ì´ë“œ Route Handler)
const returnTo = cookies().get("returnTo")?.value;
const safeReturnTo = validateReturnUrl(returnTo);
cookies().delete("returnTo");
redirect(safeReturnTo || "/dashboard");
```

### ì¿ í‚¤ ì„¤ì •

| íŒŒë¼ë¯¸í„° | ê°’          | ê·¼ê±°                                    |
| -------- | ----------- | --------------------------------------- |
| ì €ì¥ì†Œ   | HTTP Cookie | ì„œë²„ ì‚¬ì´ë“œ ì ‘ê·¼ ê°€ëŠ¥                   |
| Max-Age  | 300ì´ˆ (5ë¶„) | OAuth í”Œë¡œìš° ì»¤ë²„, ì˜¤ë˜ëœ URL ìœ„í—˜ ì œí•œ |
| SameSite | Lax         | í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìš”ì²­ ê³µê²© ë°©ì§€            |
| Path     | /           | ëª¨ë“  ë¼ìš°íŠ¸ì—ì„œ ì‚¬ìš© ê°€ëŠ¥               |

## ê²€í† í•œ ì˜µì…˜

### ì˜µì…˜ A: sessionStorage ê¸°ë°˜ (ì´ˆê¸°, ì‹¤íŒ¨)

- ë¸Œë¼ìš°ì € `sessionStorage`ì— `returnTo` ì €ì¥

**ì¥ì :**

- ë‹¨ìˆœí•¨, ì¿ í‚¤ ê´€ë¦¬ ë¶ˆí•„ìš”
- ë¸Œë¼ìš°ì € íƒ­ ë‹¨ìœ„ ìŠ¤ì½”í”„

**ë‹¨ì :**

- ì„œë²„ ì‚¬ì´ë“œ Route Handlerì—ì„œ `sessionStorage` ì ‘ê·¼ ë¶ˆê°€
- Next.js App Routerì™€ ì•„í‚¤í…ì²˜ì  ë¹„í˜¸í™˜

**ê²°ì •:** ê¸°ê°.

### ì˜µì…˜ B: ì¿ í‚¤ ê¸°ë°˜ ì €ì¥ (ì±„íƒ)

- OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ ì „ HTTP ì¿ í‚¤ì— `returnTo` ì €ì¥
- ì½œë°±ì—ì„œ ì„œë²„ê°€ ì¿ í‚¤ ì½ê¸°, ê²€ì¦, ì‚­ì œ

**ì¥ì :**

- ì„œë²„ ì‚¬ì´ë“œ Route Handlerì™€ í˜¸í™˜
- ë‹¨ê¸° ìˆ˜ëª… (5ë¶„)
- SameSite=Laxë¡œ CSRF ë³´í˜¸

**ë‹¨ì :**

- ì¿ í‚¤ ê´€ë¦¬ í•„ìš”
- ì˜¤í”ˆ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê³µê²© ë²¡í„° (ê²€ì¦ìœ¼ë¡œ ì™„í™”)

**ê²°ì •:** ì±„íƒ.

### ì˜µì…˜ C: OAuth ìƒíƒœ íŒŒë¼ë¯¸í„°

- OAuth ìƒíƒœ íŒŒë¼ë¯¸í„°ì— `returnTo` ì¸ì½”ë”©

**ì¥ì :**

- ë¬´ìƒíƒœ, OAuth ìŠ¤í™ ë‚´ì¥

**ë‹¨ì :**

- GitHub ìƒíƒœ íŒŒë¼ë¯¸í„° í¬ê¸° ì œí•œ
- CSRF ë³´í˜¸ìš©ìœ¼ë¡œ ì´ë¯¸ ì‚¬ìš© ì‹œ ë³µì¡ë„ ì¦ê°€

**ê²°ì •:** ê¸°ê°.

### ì˜µì…˜ D: ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜ ì €ì¥

- ì„¸ì…˜ í…Œì´ë¸”ì— `returnTo` ì €ì¥

**ì¥ì :**

- ì•ˆì •ì ì¸ ì„œë²„ ì‚¬ì´ë“œ ì €ì¥

**ë‹¨ì :**

- ë°ì´í„°ë² ì´ìŠ¤ ì§€ì—° ì¶”ê°€
- ë¦¬ë‹¤ì´ë ‰íŠ¸ URL ì €ì¥ì— ê³¼ë„í•œ ì—”ì§€ë‹ˆì–´ë§
- PaaS ìš°ì„  ë‹¨ìˆœì„± ìœ„ë°˜ ([ADR-06](/ko/adr/06-paas-first-infrastructure.md))

**ê²°ì •:** ê¸°ê°.

## êµ¬í˜„

### ë¦¬í„´ URL í”Œë¡œìš°

```
1. ì‚¬ìš©ìê°€ /ko/pricingì—ì„œ "GitHubìœ¼ë¡œ ë¡œê·¸ì¸" í´ë¦­
   â””â”€> ì¿ í‚¤ ì„¤ì •: returnTo=/ko/pricing; max-age=300

2. GitHub OAuthë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
   â””â”€> ì‚¬ìš©ìê°€ github.comì—ì„œ ì¸ì¦

3. GitHubì´ /api/auth/callback/githubìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
   â””â”€> ì„œë²„ê°€ returnTo ì¿ í‚¤ ì½ê¸°
   â””â”€> ê²€ì¦: "/"ë¡œ ì‹œì‘í•˜ê³  "//"ê°€ ì•„ë‹˜
   â””â”€> ì¿ í‚¤ ì‚­ì œ
   â””â”€> /ko/pricingìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

4. ì‚¬ìš©ìê°€ /ko/pricingì— ë³µê·€ (ì¸ì¦ë¨)
```

### URL ê²€ì¦ ë¡œì§

```typescript
function validateReturnUrl(url: string | undefined): string | null {
  if (!url) return null;

  // ë‹¨ì¼ ìŠ¬ë˜ì‹œë¡œ ì‹œì‘ í•„ìˆ˜ (ìƒëŒ€ ê²½ë¡œ)
  if (!url.startsWith("/")) return null;

  // í”„ë¡œí† ì½œ ìƒëŒ€ URL ê±°ë¶€ (ì˜¤í”ˆ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë²¡í„°)
  if (url.startsWith("//")) return null;

  // ì„ë² ë””ë“œ ìê²© ì¦ëª… URL ê±°ë¶€
  if (url.includes("@") || url.includes("\\")) return null;

  return url;
}
```

## ê²°ê³¼

**ê¸ì •ì :**

- OAuth ë¡œê·¸ì¸ í›„ ì›ë˜ í˜ì´ì§€ë¡œ ë³µê·€
- ë¡œì¼€ì¼/i18n ì»¨í…ìŠ¤íŠ¸ ë³´ì¡´
- Next.js App Router ì„œë²„ ì‚¬ì´ë“œ í•¸ë“¤ëŸ¬ì™€ í˜¸í™˜
- ì§§ì€ ì¿ í‚¤ ë§Œë£Œ (5ë¶„)ë¡œ ê³µê²© ìœˆë„ìš° ì œí•œ

**ë¶€ì •ì :**

- ì¿ í‚¤ ì˜¤ë²„í—¤ë“œ (ìµœì†Œ, <100 ë°”ì´íŠ¸)
- ì˜¤í”ˆ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê³µê²© í‘œë©´ (ê²€ì¦ìœ¼ë¡œ ì™„í™”)
- ì¿ í‚¤ ë¹„í™œì„±í™” ì‹œ ëŒ€ì‹œë³´ë“œë¡œ í´ë°±

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### ì˜¤í”ˆ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë°©ì§€

| ê³µê²© ë²¡í„°          | ì™„í™” ë°©ë²•        |
| ------------------ | ---------------- |
| ì ˆëŒ€ URL ì‚½ì…      | `/` ì ‘ë‘ì‚¬ í•„ìˆ˜  |
| í”„ë¡œí† ì½œ ìƒëŒ€ URL  | `//` ì ‘ë‘ì‚¬ ê±°ë¶€ |
| ìê²© ì¦ëª… í¬í•¨ URL | `@` ë¬¸ì ê±°ë¶€    |
| ë°±ìŠ¬ë˜ì‹œ ìš°íšŒ      | `\` ë¬¸ì ê±°ë¶€    |

### ì¿ í‚¤ ë³´ì•ˆ ì†ì„±

| ì†ì„±     | ê°’  | ì´ì                     |
| -------- | --- | ----------------------- |
| SameSite | Lax | í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ê³µê²© ë°©ì§€ |
| Max-Age  | 300 | ì˜¤ë˜ëœ URL ìœ„í—˜ ì œí•œ    |
| Path     | /   | ì• í”Œë¦¬ì¼€ì´ì…˜ ìŠ¤ì½”í”„     |

## ì°¸ì¡°

- [ì»¤ë°‹ 9a961ed](https://github.com/specvital/web/commit/9a961ed) - OAuth ë¦¬í„´ URL ìˆ˜ì •
- [ADR-17: next-intl i18n ì „ëµ](/ko/adr/web/17-next-intl-i18n-strategy.md)
- [Next.js Cookies API](https://nextjs.org/docs/app/api-reference/functions/cookies)
